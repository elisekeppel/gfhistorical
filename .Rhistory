(fishery_sector == "dogling" & year %in% dogling_ref_yrs) |
(fishery_sector == "trawl" & year %in% trawl_ref_yrs) |
(fishery_sector == "sable" & year %in% sable_ref_yrs)
) %>%
group_by(fishery_sector, major_stat_area_code) %>%
summarise(trf = sum(best_landed_kg + best_discarded_kg),
pop = sum(ifelse(species_code == 396, best_landed_kg + best_discarded_kg, 0)),
rrf = sum(ifelse(species_code == rrf, best_landed_kg + best_discarded_kg, 0)),
orf = sum(ifelse(!species_code == 396, best_landed_kg + best_discarded_kg, 0))) %>%
ungroup()
}
ref_catch <- get_ref_catch(catch)
View(ref_catch)
# reference catch - total catch over all reference years by major area
# and fishery
get_ref_catch <- function(dat = catch) {
dat %>% filter(
(fishery_sector == "hlrock" & year %in% hlrock_ref_yrs) |
(fishery_sector == "halibut" & year %in% halibut_ref_yrs) |
(fishery_sector == "dogling" & year %in% dogling_ref_yrs) |
(fishery_sector == "trawl" & year %in% trawl_ref_yrs) |
(fishery_sector == "sable" & year %in% sable_ref_yrs)
) %>%
group_by(year, fishery_sector, major_stat_area_code) %>%
summarise(trf = sum(best_landed_kg + best_discarded_kg),
pop = sum(ifelse(species_code == 396, best_landed_kg + best_discarded_kg, 0)),
rrf = sum(ifelse(species_code == rrf, best_landed_kg + best_discarded_kg, 0)),
orf = sum(ifelse(!species_code == 396, best_landed_kg + best_discarded_kg, 0))) %>%
ungroup()
}
ref_catch <- get_ref_catch(catch)
View(ref_catch)
# reference catch - total catch over all reference years by major area
# and fishery
get_ref_catch <- function(dat = catch,
hlrock_ref_yrs = 1997:2005,
halibut_ref_yrs = 1997:2005,
dogling_ref_yrs = 1997:2005,
trawl_ref_yrs = 1997:2005,
sable_ref_yrs = 1997:2005) {
dat %>% filter(
(fishery_sector == "hlrock" & year %in% hlrock_ref_yrs) |
(fishery_sector == "halibut" & year %in% halibut_ref_yrs) |
(fishery_sector == "dogling" & year %in% dogling_ref_yrs) |
(fishery_sector == "trawl" & year %in% trawl_ref_yrs) |
(fishery_sector == "sable" & year %in% sable_ref_yrs)
) %>%
group_by(year, fishery_sector, major_stat_area_code) %>%
summarise(trf = sum(best_landed_kg + best_discarded_kg),
pop = sum(ifelse(species_code == 396, best_landed_kg + best_discarded_kg, 0)),
rrf = sum(ifelse(species_code == rrf, best_landed_kg + best_discarded_kg, 0)),
orf = sum(ifelse(!species_code == 396, best_landed_kg + best_discarded_kg, 0))) %>%
ungroup()
}
ref_catch <- get_ref_catch(catch)
# reference catch - total catch over all reference years by major area
# and fishery
get_ref_catch <- function(dat = catch,
hlrock_ref_yrs = 1997:2005,
halibut_ref_yrs = 1997:2005,
dogling_ref_yrs = 1997:2005,
trawl_ref_yrs = 1997:2005,
sable_ref_yrs = 1997:2005) {
dat %>% filter(
(fishery_sector == "hlrock" & year %in% hlrock_ref_yrs) |
(fishery_sector == "halibut" & year %in% halibut_ref_yrs) |
(fishery_sector == "dogling" & year %in% dogling_ref_yrs) |
(fishery_sector == "trawl" & year %in% trawl_ref_yrs) |
(fishery_sector == "sable" & year %in% sable_ref_yrs)
) %>%
group_by(fishery_sector, major_stat_area_code) %>%
summarise(trf = sum(best_landed_kg + best_discarded_kg),
pop = sum(ifelse(species_code == 396, best_landed_kg + best_discarded_kg, 0)),
rrf = sum(ifelse(species_code == rrf, best_landed_kg + best_discarded_kg, 0)),
orf = sum(ifelse(!species_code == 396, best_landed_kg + best_discarded_kg, 0))) %>%
ungroup()
}
ref_catch <- get_ref_catch(catch)
devtools::load_all(".")
gfmc_rf_catch <- get_gfmc_rf_catch()
# arguments for future function:
spp <- 403
rrf <- gfmc_rf_catch %>% filter(species_code == spp)
library(gfplot)
rrf %>% tidy_catch() %>% plot_catch()
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/ref)
}
# arguments for future function:
rrf <- 403
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/ref)
}
t <- get_rrf_ratio()
dat = ref_catch
dat %>%
group_by(fishery_sector, major_stat_area_code)
rrf
View(ref_catch)
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = 'rrf'/ref)
'orf'
ref = 'orf'
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = 'rrf'/ref)
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = 'rrf'/'ref'/'orf')
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
if(ref = orf){
b <- orf
}
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/b)
}
get_rrf_ratio <- function(dat = ref_catch, ref = 'orf') {
if(ref = orf){
b <- orf
}
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/b)
}
get_rrf_ratio <- function(dat = ref_catch, ref = 'orf') {
if(ref = 'orf'){
b <- orf
}
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/b)
}
get_rrf_ratio <- function(dat = ref_catch, ref = o) {
if(ref = o){
b <- orf
}
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/b)
}
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
get_rrf_ratio <- function(dat = ref_catch, ref = o) {
if(ref = orf){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
}
get_rrf_ratio <- function(dat = ref_catch, ref = o) {
if(ref = orf){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
}
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
if(ref = orf){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
}
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
if(ref == orf){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
}
t <- get_rrf_ratio()
View(t)
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
if(ref == orf){
b <- orf
}
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
}
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
if(ref == orf){
b <- orf
}
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/b)
}
t <- get_rrf_ratio()
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
b <- orf
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/b)
}
t <- get_rrf_ratio()
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
b <- ref
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/b)
}
t <- get_rrf_ratio()
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
dat$gamma <- dat$rrf/dat$ref
}
t <- get_rrf_ratio()
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
dat$gamma <- dat$rrf/dat$orf
}
t <- get_rrf_ratio()
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
if(ref == orf){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
} else if(ref == pop){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
} else if(ref == pop){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
}
t <- get_rrf_ratio()
t <- get_rrf_ratio(ref = pop)
t <- get_rrf_ratio(ref = trf)
get_rrf_ratio <- function(dat = ref_catch, ref = orf) {
if(ref == orf){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
} else if(ref == pop){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/pop)
} else if(ref == pop){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/trf)
}
t <- get_rrf_ratio(ref = trf)
rm(orf)
t <- get_rrf_ratio(ref = trf)
get_rrf_ratio <- function(dat = ref_catch, ref = 'orf') {
if(ref == 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
} else if(ref == 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/pop)
} else if(ref == 'trf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/trf)
}
t <- get_rrf_ratio(ref = trf)
get_rrf_ratio <- function(dat = ref_catch, ref = 'orf') {
if(ref = 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
} else if(ref = 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/pop)
} else if(ref = 'trf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/trf)
}
get_rrf_ratio <- function(dat = ref_catch, ref = 'orf') {
if(ref = 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
} else if(ref = 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/pop)
} else if(ref = 'trf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/trf)
}
ref = 'orf'
if(ref == 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
}
ref == 'pop'
if(ref == 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/pop)
}
ref
rm(ref)
get_rrf_ratio <- function(dat = ref_catch, ref = 'orf') {
if(ref == 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
} else if(ref == 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/pop)
} else if(ref == 'trf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/trf)
}
t <- get_rrf_ratio()
View(t)
t <- get_rrf_ratio(pop)
t <- get_rrf_ratio(ref = 'pop')
#'
#' All rockfish catch summarised by year, fishery sector and major area for
#' trusted years of modern data
#'
#' @param dat
#'
#' @return
#' @export
#'
#' @examples
get_mod_catch_sum <- function(dat = mod_catch){
dat %>%
group_by(year, fishery_sector, major_stat_area_code) %>%
summarise(      rrf_kg = sum(ifelse(species_code == rrf, best_landed_kg + best_discarded_kg, 0)),
orf_kg = sum(ifelse(!species_code == 396, best_landed_kg + best_discarded_kg, 0)),
pop_kg = sum(ifelse(species_code == 396, best_landed_kg + best_discarded_kg, 0)),
trf_kg = sum(best_landed_kg + best_discarded_kg)) %>%
ungroup()
}
mod_catch_sum <- get_mod_catch_sum(mod_catch)
#' @param hlrock_ref_yrs
#' @param halibut_ref_yrs
#' @param dogling_ref_yrs
#' @param trawl_ref_yrs
#' @param sable_ref_yrs
#'
#' @return
#' @export
#'
#' @examples
get_ref_catch <- function(dat = catch,
hlrock_ref_yrs = 1997:2005,
halibut_ref_yrs = 1997:2005,
dogling_ref_yrs = 1997:2005,
trawl_ref_yrs = 1997:2005,
sable_ref_yrs = 1997:2005) {
dat %>% filter(
(fishery_sector == "hlrock" & year %in% hlrock_ref_yrs) |
(fishery_sector == "halibut" & year %in% halibut_ref_yrs) |
(fishery_sector == "dogling" & year %in% dogling_ref_yrs) |
(fishery_sector == "trawl" & year %in% trawl_ref_yrs) |
(fishery_sector == "sable" & year %in% sable_ref_yrs)
) %>%
group_by(fishery_sector, major_stat_area_code) %>%
summarise(      rrf_kg = sum(ifelse(species_code == rrf, best_landed_kg + best_discarded_kg, 0)),
orf_kg = sum(ifelse(!species_code == 396, best_landed_kg + best_discarded_kg, 0)),
pop_kg = sum(ifelse(species_code == 396, best_landed_kg + best_discarded_kg, 0)),
trf_kg = sum(best_landed_kg + best_discarded_kg)) %>%
ungroup()
}
ref_catch <- get_ref_catch(catch)
get_rrf_ratio <- function(dat = ref_catch, ref = 'orf') {
if(ref == 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
} else if(ref == 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/pop)
} else if(ref == 'trf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/trf)
}
t <- get_rrf_ratio()
get_rrf_ratio <- function(dat = ref_catch, ref = 'orf') {
if(ref == 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/orf)
} else if(ref == 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/pop)
} else if(ref == 'trf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf/trf)
}
get_rrf_ratio()
View(ref_catch)
get_rrf_ratio <- function(dat = ref_catch, ref = 'orf') {
if(ref == 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf_kg/orf_kg)
} else if(ref == 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf_kg/pop_kg)
} else if(ref == 'trf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf_kg/trf_kg)
}
t <- get_rrf_ratio()
View(t)
t <- get_rrf_ratio(ref = 'pop')
rrf_prop <- get_rrf_ratio(ref = 'orf')
get_rrf_prop <- function(dat = ref_catch, ref = 'orf') {
if(ref == 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf_kg/orf_kg)
} else if(ref == 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf_kg/pop_kg)
} else if(ref == 'trf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf_kg/trf_kg)
}
#' @param hlrock_ref_yrs
#' @param halibut_ref_yrs
#' @param dogling_ref_yrs
#' @param trawl_ref_yrs
#' @param sable_ref_yrs
#'
#' @return
#' @export
#'
#' @examples
get_ref_catch <- function(dat = catch,
hlrock_ref_yrs = 1997:2005,
halibut_ref_yrs = 1997:2005,
dogling_ref_yrs = 1997:2005,
trawl_ref_yrs = 1997:2005,
sable_ref_yrs = 1997:2005) {
dat %>% filter(
(fishery_sector == "hlrock" & year %in% hlrock_ref_yrs) |
(fishery_sector == "halibut" & year %in% halibut_ref_yrs) |
(fishery_sector == "dogling" & year %in% dogling_ref_yrs) |
(fishery_sector == "trawl" & year %in% trawl_ref_yrs) |
(fishery_sector == "sable" & year %in% sable_ref_yrs)
) %>%
group_by(fishery_sector, major_stat_area_code) %>%
summarise(rrf_kg = sum(ifelse(species_code == rrf, best_catch, 0)),
orf_kg = sum(ifelse(!species_code == 396, best_catch, 0)),
pop_kg = sum(ifelse(species_code == 396, best_catch, 0)),
trf_kg = sum(best_catch)) %>%
ungroup()
}
#'
#' All rockfish catch summarised by year, fishery sector and major area for
#' trusted years of modern data
#'
#' @param dat
#'
#' @return
#' @export
#'
#' @examples
get_mod_catch_sum <- function(dat = mod_catch){
dat %>%
group_by(year, fishery_sector, major_stat_area_code) %>%
summarise(rrf_kg = sum(ifelse(species_code == rrf, best_catch, 0)),
orf_kg = sum(ifelse(!species_code == 396, best_catch, 0)),
pop_kg = sum(ifelse(species_code == 396, best_catch, 0)),
trf_kg = sum(best_catch)) %>%
ungroup()
}
#' Get RRF prop
#' Get proportion of RRF catch (landings + discards)
#'
#' @param dat
#' @param ref
#'
#' @return
#' @export
#'
#' @examples
get_rrf_prop <- function(dat = ref_catch, ref = 'orf') {
if(ref == 'orf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf_kg/orf_kg)
} else if(ref == 'pop'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf_kg/pop_kg)
} else if(ref == 'trf'){
dat %>%
group_by(fishery_sector, major_stat_area_code) %>%
mutate(gamma = rrf_kg/trf_kg)
}
rrf_prop <- get_rrf_ratio(ref = 'orf')
View(rrf_prop)
