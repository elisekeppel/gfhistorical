filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
mutate(landed_kg_per_pc = ifelse(is.na(landed_kg_per_pc), 0, landed_kg_per_pc)) %>%
ungroup()
View(d)
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, landed_pcs * landed_kg_per_pc, 0),
est_discarded_kg = ifelse(discarded_kg == 0, discarded_pcs * landed_kg_per_pc, 0)) %>%
mutate(best_landed_kg = ifelse(!landed_kg == 0, landed_kg, est_landed_kg))
sum(d$landed_kg)
sum(d$est_landed_kg)
sum(d$best_landed_kg)
# calculate average wt/pc by fishery_sector and major area to apply to
# older data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup() %>%
mutate(landed_kg_per_pc = ifelse(is.na(landed_kg_per_pc), 0, landed_kg_per_pc))
# calculate average wt/pc by fishery_sector and major area to apply to
# older data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(landed_kg_per_pc = ifelse(is.na(landed_kg_per_pc), 0, landed_kg_per_pc)) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, landed_pcs * landed_kg_per_pc, 0),
est_discarded_kg = ifelse(discarded_kg == 0, discarded_pcs * landed_kg_per_pc, 0)) %>%
mutate(best_landed_kg = ifelse(!landed_kg == 0, landed_kg, est_landed_kg))
sum(d$landed_kg)
# calculate average wt/pc by fishery_sector and major area to apply to
# older data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
View(avg_wt)
d <- dat
d$fishery_sector <- tolower(d$fishery_sector)
d <- d %>%
select(database_name, fishery_sector, major_stat_area_code,
major_stat_area_name, year, trip_id, fishing_event_id, gear, best_depth,
species_code, species_common_name, landed_kg:discarded_pcs) %>%
filter(major_stat_area_code %in% major) %>%
mutate_if(is.numeric, funs(replace(., is.na(.),0))) %>%
filter(!(landed_kg == 0 & landed_pcs == 0 & discarded_kg == 0 & discarded_pcs == 0))
# group fishery sectors
d <- d %>% mutate(
fishery_sector = case_when(
fishery_sector %in% c("rockfish inside", "rockfish outside", "zn", "k/zn") ~ "hlrock",
fishery_sector %in% c("halibut", "k/l", "halibut and sablefish") ~ "halibut",
fishery_sector %in% c("spiny dogfish", "lingcod", "schedule ii") ~ "dogling",
fishery_sector %in% c("groundfish trawl") ~ "trawl",
fishery_sector %in% c("sablefish") ~ "sable",
fishery_sector %in% c("foreign") ~ "foreign"
))
# TO DO: need to work out what to do with foreign catch (will differ based on species and fishery)
if(!foreign){
d <- d %>% filter(!fishery_sector %in% "foreign")
}
fishery <- unique(d$fishery_sector)
# calculate average wt/pc by fishery_sector and major area to apply to
# older data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(landed_kg_per_pc = ifelse(is.na(landed_kg_per_pc), 0, landed_kg_per_pc)) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, landed_pcs * landed_kg_per_pc, 0),
est_discarded_kg = ifelse(discarded_kg == 0, discarded_pcs * landed_kg_per_pc, 0)) %>%
mutate(best_landed_kg = ifelse(!landed_kg == 0, landed_kg, est_landed_kg))
sum(d$landed_kg)
sum(d$est_landed_kg)
sum(d$best_landed_kg)
# calculate overall average wt/pc by fishery_sector and major area for each
# species to apply to historic data
avg_wt_overall <- d %>%
select(fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
# create modern catch based on trusted modern years of data by fishery (these are
# defaults from PBStools - should be discussed and adjusted for individual
# species or species groups)
hl_yr <- 1986
halibut_yr <- 2000
dogling_yr <- 2007
trawl_yr <- 1996
sable_yr <- 2007
modern_catch <- d %>% filter(
(fishery_sector == "hlrock" & year >= hl_yr) |
(fishery_sector == "halibut" & year >= halibut_yr) |
(fishery_sector == "dogling" & year >= dogling_yr) |
(fishery_sector == "trawl" & year >= trawl_yr) |
(fishery_sector == "sable" & year >= sable_yr)
)
modern_catch_sum <- modern_catch %>%
group_by(fishery_sector, major_stat_area_code, year) %>%
summarise(sum_landed_kg = sum(best_landed_kg))
modern_catch_by_area_and_fishery <- modern_catch %>%
filter(
(fishery_sector == "hlrock" & year %in% hlrock_ref_yrs) |
(fishery_sector == "halibut" & year %in% halibut_ref_yrs) |
(fishery_sector == "dogling" & year %in% dogling_ref_yrs) |
(fishery_sector == "trawl" & year %in% trawl_ref_yrs) |
(fishery_sector == "sable" & year %in% sable_ref_yrs)
) %>%
group_by(fishery_sector, major_stat_area_code, major_stat_area_name) %>%
summarise(landed_kg = sum(landed_kg), discarded_kg = sum(discarded_kg))
View(modern_catch_sum)
gfmc_catch_data <- here::here("data/all_gfmc_rf_catch.rds")
if (file.exists(gfmc_catch_data)) {
dat <- readRDS(gfmc_catch_data)
} else {
dat <- gfdata:::get_catch(trf)
saveRDS(dat, "data/all_gfmc_rf_catch.rds")
}
d <- dat
d$fishery_sector <- tolower(d$fishery_sector)
d <- d %>%
select(database_name, fishery_sector, major_stat_area_code,
major_stat_area_name, year, trip_id, fishing_event_id, gear, best_depth,
species_code, species_common_name, landed_kg:discarded_pcs) %>%
filter(major_stat_area_code %in% major) %>%
mutate_if(is.numeric, funs(replace(., is.na(.),0))) %>%
filter(!(landed_kg == 0 & landed_pcs == 0 & discarded_kg == 0 & discarded_pcs == 0))
# group fishery sectors
d <- d %>% mutate(
fishery_sector = case_when(
fishery_sector %in% c("rockfish inside", "rockfish outside", "zn", "k/zn") ~ "hlrock",
fishery_sector %in% c("halibut", "k/l", "halibut and sablefish") ~ "halibut",
fishery_sector %in% c("spiny dogfish", "lingcod", "schedule ii") ~ "dogling",
fishery_sector %in% c("groundfish trawl") ~ "trawl",
fishery_sector %in% c("sablefish") ~ "sable",
fishery_sector %in% c("foreign") ~ "foreign"
))
# TO DO: need to work out what to do with foreign catch (will differ based on species and fishery)
if(!foreign){
d <- d %>% filter(!fishery_sector %in% "foreign")
}
fishery <- unique(d$fishery_sector)
# calculate average wt/pc by year, fishery_sector and major area for each
# species to apply to modern piece data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(landed_kg_per_pc = ifelse(is.na(landed_kg_per_pc), 0, landed_kg_per_pc)) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, landed_pcs * landed_kg_per_pc, 0),
est_discarded_kg = ifelse(discarded_kg == 0, discarded_pcs * landed_kg_per_pc, 0)) %>%
mutate(best_landed_kg = ifelse(!landed_kg == 0, landed_kg, est_landed_kg))
gfmc_catch_data <- here::here("data/all_gfmc_rf_catch.rds")
if (file.exists(gfmc_catch_data)) {
dat <- readRDS(gfmc_catch_data)
} else {
dat <- gfdata:::get_catch(trf)
saveRDS(dat, "data/all_gfmc_rf_catch.rds")
}
d <- dat
d$fishery_sector <- tolower(d$fishery_sector)
d <- d %>%
select(database_name, fishery_sector, major_stat_area_code,
major_stat_area_name, year, trip_id, fishing_event_id, gear, best_depth,
species_code, species_common_name, landed_kg:discarded_pcs) %>%
filter(major_stat_area_code %in% major) %>%
mutate_if(is.numeric, funs(replace(., is.na(.),0))) %>%
filter(!(landed_kg == 0 & landed_pcs == 0 & discarded_kg == 0 & discarded_pcs == 0))
# group fishery sectors
d <- d %>% mutate(
fishery_sector = case_when(
fishery_sector %in% c("rockfish inside", "rockfish outside", "zn", "k/zn") ~ "hlrock",
fishery_sector %in% c("halibut", "k/l", "halibut and sablefish") ~ "halibut",
fishery_sector %in% c("spiny dogfish", "lingcod", "schedule ii") ~ "dogling",
fishery_sector %in% c("groundfish trawl") ~ "trawl",
fishery_sector %in% c("sablefish") ~ "sable",
fishery_sector %in% c("foreign") ~ "foreign"
))
# TO DO: need to work out what to do with foreign catch (will differ based on species and fishery)
if(!foreign){
d <- d %>% filter(!fishery_sector %in% "foreign")
}
fishery <- unique(d$fishery_sector)
sum(d$landed_kg)
# calculate average wt/pc by year, fishery_sector and major area for each
# species to apply to modern piece data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(landed_kg_per_pc = ifelse(is.na(landed_kg_per_pc), 0, landed_kg_per_pc)) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, landed_pcs * landed_kg_per_pc, 0),
est_discarded_kg = ifelse(discarded_kg == 0, discarded_pcs * landed_kg_per_pc, 0)) %>%
mutate(best_landed_kg = ifelse(!landed_kg == 0, landed_kg, est_landed_kg))
sum(d$best_landed_kg)
gfmc_catch_data <- here::here("data/all_gfmc_rf_catch.rds")
if (file.exists(gfmc_catch_data)) {
dat <- readRDS(gfmc_catch_data)
} else {
dat <- gfdata:::get_catch(trf)
saveRDS(dat, "data/all_gfmc_rf_catch.rds")
}
d <- dat
d$fishery_sector <- tolower(d$fishery_sector)
d <- d %>%
select(database_name, fishery_sector, major_stat_area_code,
major_stat_area_name, year, trip_id, fishing_event_id, gear, best_depth,
species_code, species_common_name, landed_kg:discarded_pcs) %>%
filter(major_stat_area_code %in% major) %>%
mutate_if(is.numeric, funs(replace(., is.na(.),0))) %>%
filter(!(landed_kg == 0 & landed_pcs == 0 & discarded_kg == 0 & discarded_pcs == 0))
# group fishery sectors
d <- d %>% mutate(
fishery_sector = case_when(
fishery_sector %in% c("rockfish inside", "rockfish outside", "zn", "k/zn") ~ "hlrock",
fishery_sector %in% c("halibut", "k/l", "halibut and sablefish") ~ "halibut",
fishery_sector %in% c("spiny dogfish", "lingcod", "schedule ii") ~ "dogling",
fishery_sector %in% c("groundfish trawl") ~ "trawl",
fishery_sector %in% c("sablefish") ~ "sable",
fishery_sector %in% c("foreign") ~ "foreign"
))
# TO DO: need to work out what to do with foreign catch (will differ based on species and fishery)
if(!foreign){
d <- d %>% filter(!fishery_sector %in% "foreign")
}
fishery <- unique(d$fishery_sector)
# calculate average wt/pc by year, fishery_sector and major area for each
# species to apply to modern piece data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc_annual = mean(landed_kg/landed_pcs)) %>%
ungroup()
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(landed_kg_per_pc_annual = ifelse(is.na(landed_kg_per_pc_annual), 0, landed_kg_per_pc_annual)) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, landed_pcs * landed_kg_per_pc_annual, 0),
est_discarded_kg = ifelse(discarded_kg == 0, discarded_pcs * landed_kg_per_pc_annual, 0)) %>%
mutate(best_landed_kg = ifelse(!landed_kg == 0, landed_kg, est_landed_kg))
# TO DO: discards
# %>%
#   mutate(best_discarded_kg = coalesce(discarded_kg, est_discarded_kg)) %>%
#   mutate(best_catch_kg = best_landed_kg + best_discarded_kg)
# calculate overall average wt/pc by fishery_sector and major area for each
# species to apply to historic data
avg_wt_overall <- d %>%
select(fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
gfmc_catch_data <- here::here("data/all_gfmc_rf_catch.rds")
if (file.exists(gfmc_catch_data)) {
dat <- readRDS(gfmc_catch_data)
} else {
dat <- gfdata:::get_catch(trf)
saveRDS(dat, "data/all_gfmc_rf_catch.rds")
}
d <- dat
d$fishery_sector <- tolower(d$fishery_sector)
d <- d %>%
select(database_name, fishery_sector, major_stat_area_code,
major_stat_area_name, year, trip_id, fishing_event_id, gear, best_depth,
species_code, species_common_name, landed_kg:discarded_pcs) %>%
filter(major_stat_area_code %in% major) %>%
mutate_if(is.numeric, funs(replace(., is.na(.),0))) %>%
filter(!(landed_kg == 0 & landed_pcs == 0 & discarded_kg == 0 & discarded_pcs == 0))
# group fishery sectors
d <- d %>% mutate(
fishery_sector = case_when(
fishery_sector %in% c("rockfish inside", "rockfish outside", "zn", "k/zn") ~ "hlrock",
fishery_sector %in% c("halibut", "k/l", "halibut and sablefish") ~ "halibut",
fishery_sector %in% c("spiny dogfish", "lingcod", "schedule ii") ~ "dogling",
fishery_sector %in% c("groundfish trawl") ~ "trawl",
fishery_sector %in% c("sablefish") ~ "sable",
fishery_sector %in% c("foreign") ~ "foreign"
))
# TO DO: need to work out what to do with foreign catch (will differ based on species and fishery)
if(!foreign){
d <- d %>% filter(!fishery_sector %in% "foreign")
}
fishery <- unique(d$fishery_sector)
# calculate average wt/pc by year, fishery_sector and major area for each
# species to apply to modern piece data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc_annual = mean(landed_kg/landed_pcs)) %>%
ungroup()
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(landed_kg_per_pc_annual = ifelse(is.na(landed_kg_per_pc_annual), 0, landed_kg_per_pc_annual)) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, landed_pcs * landed_kg_per_pc_annual, 0),
est_discarded_kg = ifelse(discarded_kg == 0, discarded_pcs * landed_kg_per_pc_annual, 0))
# TO DO: discards
# %>%
#   mutate(best_discarded_kg = coalesce(discarded_kg, est_discarded_kg)) %>%
#   mutate(best_catch_kg = best_landed_kg + best_discarded_kg)
# calculate overall average wt/pc by fishery_sector and major area for each
# species to apply to historic data
avg_wt_overall <- d %>%
select(fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt_overall, by = c("fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(landed_kg_per_pc = ifelse(landed_kg_per_pc_annual == 0, landed_kg_per_pc, landed_kg_per_pc_annual)) %>%
mutate(landed_kg_per_pc = ifelse(is.na(landed_kg_per_pc), 0, landed_kg_per_pc)) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, landed_pcs * landed_kg_per_pc, 0),
est_discarded_kg = ifelse(discarded_kg == 0, discarded_pcs * landed_kg_per_pc, 0)) %>%
mutate(best_landed_kg = ifelse(!landed_kg == 0, landed_kg, est_landed_kg)) %>%
mutate(best_discarded_kg = ifelse(!discarded_kg == 0, discarded_kg, est_discarded_kg))
sum(d$landed_kg)
sum(d$best_landed_kg)
sum(d$discarded_kg)
sum(d$best_discarded_kg)
# defaults from PBStools - should be discussed and adjusted for individual
# species or species groups)
hl_yr <- 1986
halibut_yr <- 2000
dogling_yr <- 2007
trawl_yr <- 1996
sable_yr <- 2007
modern_catch <- d %>% filter(
(fishery_sector == "hlrock" & year >= hl_yr) |
(fishery_sector == "halibut" & year >= halibut_yr) |
(fishery_sector == "dogling" & year >= dogling_yr) |
(fishery_sector == "trawl" & year >= trawl_yr) |
(fishery_sector == "sable" & year >= sable_yr)
)
# TO DO: apply overall_avg_wt to historical records only reporting pieces
# TO DO: may need to calculate avg wt per pc by major only where sector is
# unknown, or for sector only where major is unknown
modern_catch_sum <- modern_catch %>%
group_by(year, fishery_sector, major_stat_area_code) %>%
summarise(trf = sum(best_landed_kg + best_discarded_kg),
pop = sum(ifelse(species_code = 396, best_landed_kg + best_discarded_kg, 0)))
# TO DO: apply overall_avg_wt to historical records only reporting pieces
# TO DO: may need to calculate avg wt per pc by major only where sector is
# unknown, or for sector only where major is unknown
modern_catch_sum <- modern_catch %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(trf = sum(best_landed_kg + best_discarded_kg),
pop = sum(ifelse(species_code = 396, best_landed_kg + best_discarded_kg, 0))) %>%
ungroup
# TO DO: apply overall_avg_wt to historical records only reporting pieces
# TO DO: may need to calculate avg wt per pc by major only where sector is
# unknown, or for sector only where major is unknown
modern_catch_sum <- modern_catch %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(trf = sum(best_landed_kg + best_discarded_kg),
pop = sum(ifelse(species_code == 396, best_landed_kg + best_discarded_kg, 0))) %>%
ungroup
View(modern_catch_sum)
d %>% filter(species_code == 396) %>% sum(best_landed_kg)
d %>% filter(species_code == 396)
d2 <- d %>% filter(species_code == 396)
d2 <- d2 %>% sum(best_landed_kg)
d2 <- sum(d2$best_landed_kg)
d2
?sum
gfmc_catch_data <- here::here("data/all_gfmc_rf_catch.rds")
if (file.exists(gfmc_catch_data)) {
dat <- readRDS(gfmc_catch_data)
} else {
dat <- gfdata:::get_catch(trf)
saveRDS(dat, "data/all_gfmc_rf_catch.rds")
}
d <- dat
d$fishery_sector <- tolower(d$fishery_sector)
d <- d %>%
select(database_name, fishery_sector, major_stat_area_code,
major_stat_area_name, year, trip_id, fishing_event_id, gear, best_depth,
species_code, species_common_name, landed_kg:discarded_pcs) %>%
filter(major_stat_area_code %in% major) %>%
mutate_if(is.numeric, funs(replace(., is.na(.),0))) %>%
filter(!(landed_kg == 0 & landed_pcs == 0 & discarded_kg == 0 & discarded_pcs == 0))
# group fishery sectors
d <- d %>% mutate(
fishery_sector = case_when(
fishery_sector %in% c("rockfish inside", "rockfish outside", "zn", "k/zn") ~ "hlrock",
fishery_sector %in% c("halibut", "k/l", "halibut and sablefish") ~ "halibut",
fishery_sector %in% c("spiny dogfish", "lingcod", "schedule ii") ~ "dogling",
fishery_sector %in% c("groundfish trawl") ~ "trawl",
fishery_sector %in% c("sablefish") ~ "sable",
fishery_sector %in% c("foreign") ~ "foreign"
))
# TO DO: need to work out what to do with foreign catch (will differ based on species and fishery)
if(!foreign){
d <- d %>% filter(!fishery_sector %in% "foreign")
}
fishery <- unique(d$fishery_sector)
# calculate average wt/pc by year, fishery_sector and major area, and by
# fishery sector and major area, for each species to apply to piece-only data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc_annual = mean(landed_kg/landed_pcs)) %>%
ungroup() %>%
select(-year) %>%
group_by(fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0)
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc_annual = mean(landed_kg/landed_pcs))
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
summarise(landed_kg_per_pc_annual = mean(landed_kg/landed_pcs)) %>%
ungroup() %>%
select(-year)
View(avg_wt)
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
mutate(landed_kg_per_pc_annual = mean(landed_kg/landed_pcs))
# calculate average wt/pc by year, fishery_sector and major area, and by
# fishery sector and major area, for each species to apply to piece-only data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
mutate(landed_kg_per_pc_annual = mean(landed_kg/landed_pcs)) %>%
ungroup() %>%
select(-year) %>%
group_by(fishery_sector, major_stat_area_code, species_code) %>%
mutate(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(landed_kg_per_pc_annual = ifelse(is.na(landed_kg_per_pc_annual), 0, landed_kg_per_pc_annual)) %>%
mutate(landed_kg_per_pc = ifelse(is.na(landed_kg_per_pc), 0, landed_kg_per_pc)) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, ifelse(
!landed_kg_per_pc_annual == 0, landed_pcs * landed_kg_per_pc_annual, landed_pcs * landed_kg_per_pc), landed_kg),
est_discarded_kg = ifelse(discarded_kg == 0, ifelse(
!landed_kg_per_pc_annual == 0, discarded_pcs * landed_kg_per_pc_annual, discarded_pcs * landed_kg_per_pc), discarded_kg))
# calculate average wt/pc by year, fishery_sector and major area, and by
# fishery sector and major area, for each species to apply to piece-only data
avg_wt <- d %>%
select(year, fishery_sector, major_stat_area_code, species_code, landed_kg, landed_pcs) %>%
filter(landed_kg > 0 & landed_pcs > 0) %>%
group_by(year, fishery_sector, major_stat_area_code, species_code) %>%
mutate(landed_kg_per_pc_annual = mean(landed_kg/landed_pcs)) %>%
ungroup() %>%
group_by(fishery_sector, major_stat_area_code, species_code) %>%
mutate(landed_kg_per_pc = mean(landed_kg/landed_pcs)) %>%
ungroup()
# apply avg_wt to landing and discard records only reporting pieces and not kg
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code")) %>%
mutate(landed_kg_per_pc_annual = ifelse(is.na(landed_kg_per_pc_annual), 0, landed_kg_per_pc_annual)) %>%
mutate(landed_kg_per_pc = ifelse(is.na(landed_kg_per_pc), 0, landed_kg_per_pc)) %>%
mutate(
est_landed_kg = ifelse(landed_kg == 0, ifelse(
!landed_kg_per_pc_annual == 0, landed_pcs * landed_kg_per_pc_annual, landed_pcs * landed_kg_per_pc), landed_kg),
est_discarded_kg = ifelse(discarded_kg == 0, ifelse(
!landed_kg_per_pc_annual == 0, discarded_pcs * landed_kg_per_pc_annual, discarded_pcs * landed_kg_per_pc), discarded_kg))
d <- d %>%
left_join(avg_wt, by = c("year", "fishery_sector", "major_stat_area_code", "species_code"))
